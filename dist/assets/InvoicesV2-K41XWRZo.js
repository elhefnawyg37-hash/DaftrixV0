import{b as z,d as q,e as X,f as G,h as J,i as K,k as Y,l as Z,m as $,n as ee,j as e,T as r}from"./index-DYLume9J.js";import{r as i}from"./react-vendor-CJgqbvH4.js";import{I as se,a as te}from"./InvoiceReports-BSPmo-K2.js";import{I as oe}from"./InvoiceForm-hx3UW63d.js";import{d as g,X as ie,j as ne}from"./ui-vendor-BUxR0pcK.js";import"./utils-vendor-5vCYNseS.js";import"./query-vendor-GtDMnHGN.js";import"./socket-vendor-TjCxX7sJ.js";import"./DatePicker-qAKHAbTG.js";import"./Modal-CoQB3dYi.js";import"./BarcodeManager-CRNJxaNP.js";import"./SearchableSelect-BHBNN1Xe.js";const c=o=>{switch(o){case"inv-sale":return{title:"فاتورة مبيعات",transactionType:r.INVOICE_SALE,partnerType:"CUSTOMER",partnerLabel:"العميل",isQuote:!1,isReport:!1,color:"teal"};case"inv-purchase":return{title:"فاتورة مشتريات",transactionType:r.INVOICE_PURCHASE,partnerType:"SUPPLIER",partnerLabel:"المورد",isQuote:!1,isReport:!1,color:"slate"};case"inv-ret-sale":return{title:"مرتجع مبيعات",transactionType:r.RETURN_SALE,partnerType:"CUSTOMER",partnerLabel:"العميل",isQuote:!1,isReport:!1,color:"rose"};case"inv-ret-purchase":return{title:"مرتجع مشتريات",transactionType:r.RETURN_PURCHASE,partnerType:"SUPPLIER",partnerLabel:"المورد",isQuote:!1,isReport:!1,color:"indigo"};case"inv-reports":return{title:"تقارير الفواتير",transactionType:r.INVOICE_SALE,partnerType:"CUSTOMER",partnerLabel:"العميل",isQuote:!1,isReport:!0,color:"blue"};default:return{title:"المبيعات",transactionType:r.INVOICE_SALE,partnerType:"CUSTOMER",partnerLabel:"العميل",isQuote:!1,isReport:!1,color:"teal"}}},Ne=({viewType:o,onSaveInvoice:h,onDeleteInvoice:p,onAddPartner:I})=>{const[V,n]=i.useState("list"),[t,m]=i.useState(null),[C,l]=i.useState(""),[E,a]=i.useState(""),[S,ae]=i.useState(1),T=200,{data:D,isLoading:L}=z({page:S,limit:T}),{data:j,isLoading:H}=q({limit:1e3}),{data:re}=X(),{data:B}=G(),{data:F}=J(),{data:y}=K(),{data:U}=Y(),{data:A}=Z(),{data:Q}=$(),{invalidateInvoices:R,invalidatePartners:v,invalidateProducts:P,invalidateProductStocks:N}=ee(),d=D?.invoices||[],O=j?.partners||[],W=L||H,f=i.useMemo(()=>{if(t){if(t.startsWith("PUR-"))return c("inv-purchase");if(t.startsWith("RET-P-"))return c("inv-ret-purchase");if(t.startsWith("RET-S-")||t.startsWith("RET-SALE-"))return c("inv-ret-sale");if(t.startsWith("SALE-")||t.startsWith("INV-"))return c("inv-sale")}return c(o)},[o,t]);i.useEffect(()=>{if(o.startsWith("inv-edit|")){const s=o.split("|")[1];m(s),n("create")}else n("list"),m(null);l(""),a("")},[o]);const k=()=>{m(null),n("create")},M=s=>{m(s.id),n("create")},w=(s,u)=>{try{if(a(""),!s.partnerId)throw new Error("Partner is required");h(s,u),R(),v(),P(),N(),l("تم حفظ العملية بنجاح"),n("list"),setTimeout(()=>l(""),4e3)}catch(x){throw a(x.message||"حدث خطأ أثناء الحفظ"),window.scrollTo(0,0),x}},b=s=>{if(p)try{p(s),R(),v(),P(),N(),l("تم حذف الفاتورة بنجاح"),setTimeout(()=>l(""),3e3)}catch(u){a(u.message),setTimeout(()=>a(""),5e3)}},_=s=>{confirm("هل تريد تحويل هذا العرض إلى فاتورة مبيعات جديدة؟")&&alert("سيتم تحويلك إلى صفحة المبيعات لإكمال الفاتورة.")};if(W&&d.length===0)return e.jsxDEV("div",{className:"space-y-4 animate-pulse",children:[e.jsxDEV("div",{className:"h-12 bg-slate-200 rounded"},void 0,!1,{fileName:"F:/Codes/ERP/18 -12 B/Cloud ERP 12-16 H/Cloud ERP/pages/InvoicesV2.tsx",lineNumber:149,columnNumber:17},void 0),e.jsxDEV("div",{className:"h-64 bg-slate-200 rounded"},void 0,!1,{fileName:"F:/Codes/ERP/18 -12 B/Cloud ERP 12-16 H/Cloud ERP/pages/InvoicesV2.tsx",lineNumber:150,columnNumber:17},void 0),e.jsxDEV("div",{className:"h-64 bg-slate-200 rounded"},void 0,!1,{fileName:"F:/Codes/ERP/18 -12 B/Cloud ERP 12-16 H/Cloud ERP/pages/InvoicesV2.tsx",lineNumber:151,columnNumber:17},void 0)]},void 0,!0,{fileName:"F:/Codes/ERP/18 -12 B/Cloud ERP 12-16 H/Cloud ERP/pages/InvoicesV2.tsx",lineNumber:148,columnNumber:13},void 0);if(f.isReport)return e.jsxDEV(se,{invoices:d},void 0,!1,{fileName:"F:/Codes/ERP/18 -12 B/Cloud ERP 12-16 H/Cloud ERP/pages/InvoicesV2.tsx",lineNumber:157,columnNumber:16},void 0);if(V==="create"){const s=t?d.find(u=>u.id===t):void 0;return e.jsxDEV("div",{className:"h-full relative",children:[E&&e.jsxDEV("div",{className:"absolute top-4 left-1/2 -translate-x-1/2 z-50 bg-rose-600 text-white px-6 py-3 rounded-xl shadow-xl flex items-center gap-3 animate-bounce",children:[e.jsxDEV(g,{size:20},void 0,!1,{fileName:"F:/Codes/ERP/18 -12 B/Cloud ERP 12-16 H/Cloud ERP/pages/InvoicesV2.tsx",lineNumber:166,columnNumber:25},void 0)," ",E," ",e.jsxDEV("button",{onClick:()=>a(""),children:e.jsxDEV(ie,{size:16},void 0,!1,{fileName:"F:/Codes/ERP/18 -12 B/Cloud ERP 12-16 H/Cloud ERP/pages/InvoicesV2.tsx",lineNumber:166,columnNumber:98},void 0)},void 0,!1,{fileName:"F:/Codes/ERP/18 -12 B/Cloud ERP 12-16 H/Cloud ERP/pages/InvoicesV2.tsx",lineNumber:166,columnNumber:61},void 0)]},void 0,!0,{fileName:"F:/Codes/ERP/18 -12 B/Cloud ERP 12-16 H/Cloud ERP/pages/InvoicesV2.tsx",lineNumber:165,columnNumber:21},void 0),e.jsxDEV(oe,{config:f,initialData:s,partners:O,priceLists:U||[],productStocks:y||[],costCenters:B||[],warehouses:F||[],salesmen:A||[],systemConfig:Q,invoicesHistory:d,onSave:w,onCancel:()=>n("list"),onAddPartner:I,onDelete:b},void 0,!1,{fileName:"F:/Codes/ERP/18 -12 B/Cloud ERP 12-16 H/Cloud ERP/pages/InvoicesV2.tsx",lineNumber:169,columnNumber:17},void 0)]},void 0,!0,{fileName:"F:/Codes/ERP/18 -12 B/Cloud ERP 12-16 H/Cloud ERP/pages/InvoicesV2.tsx",lineNumber:163,columnNumber:13},void 0)}return e.jsxDEV("div",{className:"space-y-4 h-full flex flex-col",children:[E&&e.jsxDEV("div",{className:"p-4 bg-rose-50 text-rose-700 rounded-xl flex items-center gap-3 border border-rose-100 animate-fade-in",children:[e.jsxDEV(g,{size:20},void 0,!1,{fileName:"F:/Codes/ERP/18 -12 B/Cloud ERP 12-16 H/Cloud ERP/pages/InvoicesV2.tsx",lineNumber:191,columnNumber:143},void 0)," ",E]},void 0,!0,{fileName:"F:/Codes/ERP/18 -12 B/Cloud ERP 12-16 H/Cloud ERP/pages/InvoicesV2.tsx",lineNumber:191,columnNumber:23},void 0),C&&e.jsxDEV("div",{className:"p-4 bg-emerald-50 text-emerald-700 rounded-xl flex items-center gap-3 border border-emerald-100 animate-fade-in",children:[e.jsxDEV(ne,{size:20},void 0,!1,{fileName:"F:/Codes/ERP/18 -12 B/Cloud ERP 12-16 H/Cloud ERP/pages/InvoicesV2.tsx",lineNumber:192,columnNumber:154},void 0)," ",C]},void 0,!0,{fileName:"F:/Codes/ERP/18 -12 B/Cloud ERP 12-16 H/Cloud ERP/pages/InvoicesV2.tsx",lineNumber:192,columnNumber:25},void 0),e.jsxDEV(te,{invoices:d,config:f,onCreate:k,onEdit:M,onDelete:b,onConvertQuote:_},void 0,!1,{fileName:"F:/Codes/ERP/18 -12 B/Cloud ERP 12-16 H/Cloud ERP/pages/InvoicesV2.tsx",lineNumber:194,columnNumber:13},void 0)]},void 0,!0,{fileName:"F:/Codes/ERP/18 -12 B/Cloud ERP 12-16 H/Cloud ERP/pages/InvoicesV2.tsx",lineNumber:190,columnNumber:9},void 0)};export{Ne as InvoicesV2};
